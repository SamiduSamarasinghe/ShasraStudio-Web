https://chatgpt.com/g/g-2DQzU5UZl-code-copilot/c/46cd6a15-e2bd-44d2-95c4-97d9087e843a

1.
<?php
// login.php

session_start();
include 'connection.php';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $username = $_POST['username'];
    $password = $_POST['password'];

    if (empty($username) || empty($password)) {
        echo 'Please fill in both fields.';
        exit();
    }

    $stmt = $con->prepare("SELECT Password FROM customer WHERE Username = ?");
    $stmt->bind_param("s", $username);
    $stmt->execute();
    $stmt->store_result();

    if ($stmt->num_rows > 0) {
        $stmt->bind_result($stored_password);
        $stmt->fetch();

        if (password_verify($password, $stored_password)) {
            $_SESSION['loggedin'] = true;
            $_SESSION['username'] = $username;
            echo 'success';
        } else {
            echo 'Invalid Username or Password.';
        }
    } else {
        echo 'Invalid Username or Password.';
    }

    $stmt->close();
    $con->close();
} else {
    header("Location: log_in.html");
    exit();
}
?>




2.
<?php
// home_logged.php

session_start();

if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
    header("Location: home.html");
    exit();
}

// Rest of your code for logged-in users
?>
<!DOCTYPE html>
<html>
<head>
    <title>Home - Logged In</title>
</head>
<body>
    <h1>Welcome, <?php echo htmlspecialchars($_SESSION['username']); ?>!</h1>
    <a href="logout.php">Logout</a>
    <!-- Rest of your HTML content -->
</body>
</html>



3.
<?php
// logout.php

session_start();
session_unset();
session_destroy();

header("Location: home.html");
exit();
?>




4.
<?php
// some_page.php

session_start();

if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
    header("Location: log_in.html");
    exit();
}

// Rest of your code for logged-in users
?>
<!DOCTYPE html>
<html>
<head>
    <title>Some Page</title>
</head>
<body>
    <h1>Welcome to Some Page</h1>
    <!-- Rest of your HTML content -->
</body>
</html>




Session Time Out related codes
---------------------------------


1. 
<?php
// login.php

session_start();
include 'connection.php';

// Define session timeout duration (in seconds)
define('SESSION_TIMEOUT', 1800);

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $username = $_POST['username'];
    $password = $_POST['password'];

    if (empty($username) || empty($password)) {
        echo 'Please fill in both fields.';
        exit();
    }

    $stmt = $con->prepare("SELECT Password FROM customer WHERE Username = ?");
    $stmt->bind_param("s", $username);
    $stmt->execute();
    $stmt->store_result();

    if ($stmt->num_rows > 0) {
        $stmt->bind_result($stored_password);
        $stmt->fetch();

        if (password_verify($password, $stored_password)) {
            $_SESSION['loggedin'] = true;
            $_SESSION['username'] = $username;
            $_SESSION['last_activity'] = time(); // Record the current time
            echo 'success';
        } else {
            echo 'Invalid Username or Password.';
        }
    } else {
        echo 'Invalid Username or Password.';
    }

    $stmt->close();
    $con->close();
} else {
    header("Location: log_in.html");
    exit();
}
?>



2. new file
<?php
// session_check.php

session_start();

// Define session timeout duration (in seconds)
define('SESSION_TIMEOUT', 1800);

if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
    header("Location: log_in.html");
    exit();
}

// Check if session has expired
if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity']) > SESSION_TIMEOUT) {
    // Last activity was more than the timeout duration ago
    session_unset();     // Unset session variables
    session_destroy();   // Destroy the session
    header("Location: log_in.html");
    exit();
}

// Update last activity time
$_SESSION['last_activity'] = time();
?>



3.
<?php
// home_logged.php

include 'session_check.php';

// Rest of your code for logged-in users
?>
<!DOCTYPE html>
<html>
<head>
    <title>Home - Logged In</title>
</head>
<body>
    <h1>Welcome, <?php echo htmlspecialchars($_SESSION['username']); ?>!</h1>
    <a href="logout.php">Logout</a>
    <!-- Rest of your HTML content -->
</body>
</html>



4.
<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Check if the user is logged in
            if (localStorage.getItem('loggedin') !== 'true') {
                window.location.href = 'log_in.html';
            }
        });
    </script>
</head>
<body>
    <h1>Welcome to the Home Page</h1>
    <a href="logout.html" onclick="logout()">Logout</a>
    <!-- Rest of your HTML content -->

    <script>
        function logout() {
            localStorage.removeItem('loggedin');
            window.location.href = 'home.html';
        }
    </script>
</body>
</html>




5.
login.html

<script>
    $(document).ready(function () {
        $('#form').on('submit', function (e) {
            e.preventDefault();
            var username = $('#username').val();
            var password = $('#password').val();
            var errorMessage = $('#error-message');

            $.ajax({
                type: 'POST',
                url: 'login.php',
                data: { username: username, password: password },
                success: function (response) {
                    if (response === 'success') {
                        localStorage.setItem('loggedin', 'true');
                        window.location.href = 'home_logged.html';
                    } else {
                        errorMessage.text(response);
                    }
                }
            });
        });
    });
</script>







